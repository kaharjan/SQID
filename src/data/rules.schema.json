{
    "$id": "http://iccl.inf.tu-dresden.de/marpl/schema",
    "$schema": "http://json-schema.org/draft-04/schema#",
    "title": "MARPL rules",
    "definitions": {
        "object-term": {
            "$id": "#object-term",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["variable", "literal"]
                        },
                "value": { "type": "string",
                           "minLength": 1
                         }
            },
            "required": ["type", "value"]
        },

        "set-literal": {
            "$id": "#set-literal",
            "properties": {
                "type": { "type": "string",
                          "enum": ["set-term"]
                        },
                "assignments": { "type": "array",
                                 "items": { "type": "object",
                                            "properties": {
                                                "attribute": { "$ref": "#/definitions/object-term" },
                                                "value": { "$ref": "#/definitions/object-term" }
                                            },
                                            "required": ["attribute", "value"]
                                          },
                                 "uniqueItems": true
                               }
            },
            "required": ["type", "assignments"]
        },
        "set-variable": {
            "$id": "#set-variable",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["set-variable"]
                        },
                "value": { "type": "string",
                           "minLength": 1
                         }
            },
            "required": ["type", "value"]
        },
        "set-term": {
            "$id": "#set-term",
            "oneOf": [ { "$ref": "#/definitions/set-literal" },
                       { "$ref": "#/definitions/set-variable" }
                     ]
        },
        "set-atom": {
            "$id": "#set-atom",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["set-atom"]
                        },
                "attribute": { "$ref": "#/definitions/object-term" },
                "value": { "$ref": "#/definitions/object-term" },
                "set": { "$ref": "#/definitions/set-term" }
            },
            "required": ["type", "attribute", "value", "annotation"]
        },

        "relational-atom-base": {
            "$id": "#relational-atom",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["relational-atom"]
                        },
                "predicate": { "type": "string",
                               "minLength": 1
                             },
                "arguments": { "type": "array",
                               "items": { "$ref": "#/definitions/object-term" }
                             },
                "annotation": { "type": "object" }
            },
            "required": ["type", "predicate", "arguments", "annotation"]
        },
        "function-term": {
            "$id": "function-term",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["function-term"]
                        },
                "name": { "type": "string",
                          "minLength": 1
                        },
                "arguments": { "type": "array",
                               "items": {
                                   "oneOf": [ { "$ref": "#/definitions/object-term" },
                                              { "#ref": "#/definitions/set-term" }
                                            ]
                               }
                             }
            },
            "required": ["type", "name", "arguments"]
        },
        "relational-atom": {
            "$id": "#relational-atom",
            "type": "object",
            "allOf": [ { "$ref": "#/definitions/relational-atom-base" },
                       { "properties": { "annotation": { "$ref": "#/definitions/set-term" }
                                       }
                       }
                     ]
        },
        "relational-atom-with-function-term": {
            "$id": "#relational-atom-with-function-term",
            "type": "object",
            "allOf": [ { "$ref": "#/definitions/relational-atom-base" },
                       { "properties": { "annotation": { "$ref": "#/definitions/function-term" }
                                       }
                       }
                     ]
        },

        "placeholder": {
            "$id": "#placeholder",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["star", "plus"]
                        }
            },
            "required": ["type"]
        },
        "assignment": {
            "$id": "#assignment",
            "type": "object",
            "properties": {
                "attribute": { "$ref": "#/definitions/object-term" },
                "value": { "oneOf": [ { "$ref": "#/definitions/object-term" },
                                      { "$ref": "#/definitions/placeholder" }
                                    ]
                         }
            },
            "required": ["attribute", "value"]
        },
        "specifier": {
            "$id": "#specifier",
            "type": "object",
            "properties": {
                "type": { "type": "string",
                          "enum": ["open-specifier", "closed-specifier"]
                        },
                "assigmnents": { "type": "array",
                                 "items": { "$ref": "#/definitions/assignment" }
                               }
            },
            "required": ["type", "assignments"]
        },
        "specifier-expression": {
            "$id": "#specifier-difference",
            "type": "object",
            "properties":  {
                "type": { "type": "string",
                          "enum": ["union", "intersection", "difference"]
                        },
                "specifiers": { "type": "array",
                                "items": { "$ref": "#/definitions/specifier-term" },
                                "minItems": 1
                              }
            },
            "required": ["type", "specifiers"]
        },
        "specifier-term": {
            "$id": "#specifier-term",
            "oneOf": [ { "$ref": "#/definitions/specifier" },
                       { "$ref": "#/definitions/specifier-expression" }
                     ]
        },
        "specifier-atom": {
            "$id": "#specifier-atom",
            "type": "object",
            "properties": {
                "specifier": { "$ref": "#/definitions/specifier-term" },
                "set": { "$ref": "#/definitions/set-variable" }
            },
            "required": ["specifier", "set"]
        }

    },
    "type": "object",
    "properties": {
        "body": {
            "type": "array",
            "items": { "oneOf": [ { "$ref": "#/definitions/relational-atom" },
                                  { "$ref": "#/definitions/set-atom" },
                                  { "$ref": "#/definitions/specifier-atom" },
                                ]
                     }
        },
        "head": {
            "oneOf": [ { "$ref": "#/definitions/relational-atom" },
                       { "$ref": "#/definitions/relational-atom-with-function-term" }
                     ]
        }
    },
    "required": ["body", "head"]
}
